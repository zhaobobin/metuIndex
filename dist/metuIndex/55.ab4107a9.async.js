webpackJsonp([55],{krA1:function(e,t,a){"use strict";var n=a("ouCL");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a("+TWC"));a("QX4N");var c=n(a("Gj0I")),s=n(a("rAzg")),u=a("0xDb"),o=function(e){return new window.OSS.Wrapper({region:e.region,bucket:e.bucket,accessKeyId:e.credentials.AccessKeyId,accessKeySecret:e.credentials.AccessKeySecret,stsToken:e.credentials.SecurityToken})},i=function(e,t){for(var a=window.atob(e),n=a.length,r=new Uint8Array(n);n--;)r[n]=a.charCodeAt(n);return new Blob([r],{type:t})},l={namespace:"oss",state:{loading:!1,submitting:!1,exif:""},effects:{list:s.default.mark(function e(t,a){var n,r,c,o,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r=t.callback,c=a.call,o=a.put,e.next=4,o({type:"changeLoading",payload:!0});case 4:return e.next=6,c(function(e){return(0,u.Request)("/api/PhotoList",{method:"POST",body:e})},{payload:n});case 6:return i=e.sent,e.next=9,r(i);case 9:return e.next=11,o({type:"changeList",payload:i});case 11:return e.next=13,o({type:"changeLoading",payload:!1});case 13:case"end":return e.stop()}},e)}),detail:s.default.mark(function e(t,a){var n,r,c,o,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r=t.callback,c=a.call,o=a.put,e.next=4,o({type:"changeLoading",payload:!0});case 4:return e.next=6,c(function(e){return(0,u.Request)("/api/FileOssEdit",{method:"POST",body:e})},{});case 6:return i=e.sent,e.next=9,r(i);case 9:return e.next=11,o({type:"changeDetail",payload:i});case 11:return e.next=13,o({type:"changeLoading",payload:!1});case 13:case"end":return e.stop()}},e)}),exif:s.default.mark(function(e,t){var a,n,r,c,o,i;return s.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=e.payload,n=e.callback,r=t.call,c=t.put,o=a.url+"?x-oss-process=image/info",s.next=5,(0,u.FetchGet)(o);case 5:return i=s.sent,s.next=8,n(i);case 8:case"end":return s.stop()}},i)}),upload:s.default.mark(function e(t,a){var n,r,i,l,d,p,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.payload,r=t.callback,i=a.call,l=a.put,!(p=u.Storage.get(u.ENV.ossToken,7200))){e.next=7;break}d=p,e.next=11;break;case 7:return e.next=9,i(function(e){return(0,u.Request)("/oss/token",{method:"POST",body:e})},{});case 9:d=e.sent,u.Storage.set(u.ENV.ossToken,d);case 11:0===d.code?(f=o(d.data),f.multipartUpload(n.key,n.file,{}).then(function(e){var t=e.res.requestUrls[0].split("?")[0];return t=t.replace("metuwang.oss-cn-qingdao.aliyuncs.com","photo.metuwang.com"),r(t)}).catch(function(e){c.default.error({message:"\u4e0a\u4f20\u5931\u8d25\uff01"})})):c.default.error({message:d.message});case 12:case"end":return e.stop()}},e)}),uploadBase64:s.default.mark(function e(t,a){var n,r,l,d,p,f,y,g,h,m,x;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r=t.callback,l=a.call,d=a.put,e.next=4,l(function(e){return(0,u.Request)("/api/FileOssEdit",{method:"POST",body:e})},{});case 4:p=e.sent,0===p.code&&(f=o(p.data),y=n.base64,g=y.split(",")[1],h=y.split(";")[0].split(":")[1],m=i(g,h),x=new FileReader,x.readAsArrayBuffer(m),x.onload=function(e){var t=new window.OSS.Buffer(e.target.result);f.put(n.key,t).then(function(e){var t=e.res.requestUrls[0].split("?")[0];return t=t.replace("metuwang.oss-cn-qingdao.aliyuncs.com","photo.metuwang.com"),r(t)}).catch(function(e){c.default.error({message:"\u4e0a\u4f20\u5931\u8d25\uff01",description:e})})});case 6:case"end":return e.stop()}},e)}),del:s.default.mark(function e(t,a){var n,r,i,l,d,p;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r=t.callback,i=a.call,l=a.put,e.next=4,l({type:"changeSubmitting",payload:!0});case 4:return e.next=6,i(function(e){return(0,u.Request)("/api/FileOssEdit",{method:"POST",body:e})},{});case 6:return d=e.sent,1===d.status&&(p=o(d.data),p.deleteMulti(n.keys).catch(function(e){c.default.error({message:"\u5220\u9664\u5931\u8d25\uff01",description:e})})),e.next=10,l({type:"changeSubmitting",payload:!1});case 10:case"end":return e.stop()}},e)})},reducers:{changeLoading:function(e,t){var a=t.payload;return(0,r.default)({},e,{loading:a,uploadAvatar:""})},changeSubmitting:function(e,t){var a=t.payload;return(0,r.default)({},e,{submitting:a})}}};t.default=l}});